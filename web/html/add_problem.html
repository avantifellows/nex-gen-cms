{{ define "content" }}
<div class="mx-auto px-4 bg-white shadow-md">
    <h2 class="text-lg font-semibold mb-4">Add New Problem</h2>

    <!-- type, skills, concepts -->
    <div class="grid grid-cols-3 gap-6 mb-6">
        <div>
            <p class="font-semibold mb-2">Select Type:</p>
            <select name="problem-type-dropdown" class="w-full border border-gray-300 rounded p-2">
                {{ template "problem_type_options" }}
            </select>
        </div>
        <div>
            <p class="font-semibold mb-2">Select Skills:</p>
            <select name="skills-dropdown" multiple hx-trigger="load"
                class="w-full border border-gray-300 rounded p-2 h-20 overflow-y-auto" hx-get="/api/skills">
                <option disabled>Loading skills...</option>
            </select>
        </div>
        <div>
            <p class="font-semibold mb-2">Select Concepts:</p>
            <select name="concepts-dropdown" multiple hx-trigger="load"
                class="w-full border border-gray-300 rounded p-2 h-20 overflow-y-auto"
                hx-get="/api/concepts?topic_id={{.TopicPtr.ID}}">
                <option disabled>Loading concepts...</option>
            </select>
            <a href="#" class="text-blue-600 underline">Add Concept from other topic</a>
        </div>
    </div>

    <!-- difficulty -->
    <div class="mb-6">
        <p class="font-semibold mb-2">Difficulty Rating</p>
        <label class="mr-4"><input type="radio" name="difficulty"> 1</label>
        <label class="mr-4"><input type="radio" name="difficulty"> 2</label>
        <label class="mr-4"><input type="radio" name="difficulty"> 3</label>
    </div>

    <!-- Question editor -->
    <div class="mb-6">
        <p class="font-semibold mb-2">Text</p>
        {{ template "editor" . }}
    </div>

    <!-- Options -->
    <div class="mb-6">
        <p class="font-semibold mb-2">Options</p>
        <!-- MCQ Option Tabs -->
        <div id="option-tabs" class="flex items-center overflow-x-auto">
            <!-- Tabs will be inserted before this -->
            <!-- Add (+) Tab -->
            <button id="add-tab" title="Add Option" class="mcq-tab-add">+</button>
        </div>

        <!-- Shared Editor -->
        {{ template "editor" . }}
    </div>

    <!-- ANSWER -->
    <!-- <div class="mb-6">
        <p class="font-semibold mb-2">ANSWER</p>
        <label class="mr-4"><input type="checkbox" name="answer"> A</label>
        <label class="mr-4"><input type="checkbox" name="answer"> B</label>
        <label class="mr-4"><input type="checkbox" name="answer"> C</label>
        <label class="mr-4"><input type="checkbox" name="answer"> D</label>
    </div> -->

    <!-- SOLUTION -->
    <!-- <div class="mb-6">
        <p class="font-semibold mb-2">SOLUTION</p>
        <textarea class="w-full border p-2 h-32" placeholder="Enter detailed solution..."></textarea>
    </div> -->

    <!-- TAGS -->
    <!-- <div class="mb-6">
        <p class="font-semibold mb-2">TAGS</p>
        <input type="text" class="w-full border p-2" placeholder="Assign Hashtags">
    </div> -->

    <!-- SOURCE -->
    <!-- <div class="mb-6">
        <p class="font-semibold mb-2">SOURCE</p>
        <table class="w-full text-left border border-gray-300">
            <thead class="bg-gray-200">
                <tr>
                    <th class="px-4 py-2">Name</th>
                    <th class="px-4 py-2">Mode</th>
                    <th class="px-4 py-2">Year</th>
                    <th class="px-4 py-2">Description</th>
                    <th class="px-4 py-2">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="px-4 py-2" colspan="5" align="center">No Source Added</td>
                </tr>
            </tbody>
        </table>
        <a href="#" class="text-blue-600 underline mt-2 inline-block">Add Source</a>
    </div> -->

    <!-- SAVE BUTTON -->
    <!-- <button class="w-full bg-blue-500 text-white py-3 font-semibold rounded hover:bg-blue-600">SAVE</button> -->
</div>
<script>
    const optionTabs = document.getElementById('option-tabs');
    const addTabButton = document.getElementById('add-tab');

    const labelPool = 'ABCDEFGHIJ';
    let tabs = new Array(4).fill(null); // Start with 4 tabs
    let activeIndex = 0;

    function getLabel(index) {
        return labelPool[index];
    }

    function renderTabs() {
        document.querySelectorAll('.mcq-tab').forEach(tab => tab.remove());

        tabs.forEach((_, index) => {
            const label = getLabel(index);
            const tab = document.createElement('div');
            tab.className = 'mcq-tab' + (index === activeIndex ? ' active' : '');
            tab.dataset.index = index;
            tab.innerHTML = `
                <span class="mr-2">${label}</span>
                <button title="Remove" class="remove-btn">&times;</button>
            `;
            tab.addEventListener('click', () => setActiveTab(index));
            tab.querySelector('.remove-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                removeTab(index);
            });
            optionTabs.insertBefore(tab, addTabButton);
        });

        // Hide "+" button if 10 or more tabs
        if (tabs.length >= 10) {
            addTabButton.style.display = 'none';
        } else {
            addTabButton.style.display = 'flex'; // or 'inline-flex' depending on your styling
        }
    }

    function setActiveTab(index) {
        activeIndex = index;
        document.querySelectorAll('.mcq-tab').forEach((tab, i) => {
            tab.classList.toggle('active', i === index);
        });
        // Update editor content if needed
    }

    function addTab() {
        if (tabs.length >= labelPool.length) return;
        tabs.push(null);
        activeIndex = tabs.length - 1;
        renderTabs();
    }

    function removeTab(index) {
        if (tabs.length <= 1) {
            alert("At least one tab must remain.");
            return;
        }

        tabs.splice(index, 1);
        if (activeIndex >= tabs.length) {
            activeIndex = tabs.length - 1;
        }
        renderTabs();
    }

    addTabButton.addEventListener('click', addTab);

    // Initial render
    renderTabs();
</script>
{{ end }}