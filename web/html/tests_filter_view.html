<table class="min-w-full bg-white">
    <thead>
        <tr class="bg-gray-200 text-gray-600 text-sm">
            <th class="py-4 px-6 text-left">
                <a href="#" hx-get="/tests" hx-target="body" hx-on:click="updateTableSortState('1', 'tests');">
                    Code <i class="fas fa-sort"></i>
                </a>
            </th>
            <th class="px-6 text-left">
                <a href="#" hx-get="/tests" hx-target="body" hx-on:click="updateTableSortState('2', 'tests');">
                    Name <i class="fas fa-sort"></i>
                </a>
            </th>
            <th class="px-6 text-center">
                <a href="#" hx-get="/tests" hx-target="body" hx-on:click="updateTableSortState('3', 'tests');">
                    # of questions <i class="fas fa-sort"></i>
                </a>
            </th>
            <th class="px-6 text-center">
                <a href="#" hx-get="/tests" hx-target="body" hx-on:click="updateTableSortState('4', 'tests');">
                    Marks <i class="fas fa-sort"></i>
                </a>
            </th>
            <th class="px-6 text-center">
                <a href="#" hx-get="/tests" hx-target="body" hx-on:click="updateTableSortState('5', 'tests');">
                    Duration <i class="fas fa-sort"></i>
                </a>
            </th>
            <th class="px-6 text-center">
                <a href="#" hx-get="/tests" hx-target="body" hx-on:click="updateTableSortState('6', 'tests');">
                    Set <i class="fas fa-sort"></i>
                </a>
            </th>
            <th class="px-6 text-center">Actions</th>
        </tr>
    </thead>
    <tbody id="test-table-body" class="text-gray-600 text-sm" hx-get="/api/tests" hx-trigger="load"
        hx-include="#curriculum-dropdown, #grade-dropdown, #testtype-dropdown" hx-ext="testsLoader">
        <!-- Rows will be dynamically inserted here -->
    </tbody>
</table>
<script>
    (function () {
        htmx.defineExtension('testsLoader', {
            onEvent: function (name, event) {
                if (name === "htmx:beforeRequest") {
                    const requestPath = event.detail.elt.getAttribute("hx-get");

                    if (requestPath === "/api/tests") {
                        if (sessionStorage.getItem(window.TESTS_LOADED_KEY) === "true") {
                            console.log("Skipping /api/tests request because tests are already loaded.");
                            event.preventDefault();
                        }
                    }
                } else if (name === "htmx:afterRequest") {
                    const requestPath = event.detail.elt.getAttribute("hx-get");

                    if (requestPath === "/api/tests") {
                        const status = event.detail.xhr.status;
                        if (status >= 200 && status < 300) {
                            sessionStorage.setItem(window.TESTS_LOADED_KEY, 'true');
                        }
                    }
                }
            }
        });
    })();
</script>