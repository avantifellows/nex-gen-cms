<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>{{ getName .TestPtr "en" }}</title>
<style>
  @font-face {
    font-family: 'Segoe UI';
    src: url('/web/static/fonts/segoeui.ttf') format('truetype');
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }
  @font-face {
    font-family: 'Segoe UI';
    src: url('/web/static/fonts/seguisb.ttf') format('truetype');
    font-weight: 600;
    font-style: normal;
    font-display: swap;
  }
  @font-face {
    font-family: 'Segoe UI';
    src: url('/web/static/fonts/segoeuib.ttf') format('truetype');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
  }
  body, .font-sans { font-family: 'Segoe UI', Georgia, 'Times New Roman', Arial, sans-serif !important; }
  mjx-container, mjx-container * { font-family: 'Segoe UI', Georgia, 'Times New Roman', Arial, sans-serif !important; }
</style>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="font-sans text-[14px] m-5 mt-0">

    <div class="flex justify-between mb-3 w-full">
        <h2 class="text-lg font-bold">{{ getName .TestPtr "en" }}</h2>
        <h2 class="text-lg font-bold">Test Code: {{ .TestPtr.Code }}</h2>
    </div>

    <!-- Table for Answer Sheet -->
    <table class="table-auto w-full border border-gray-300 text-center text-sm">
        <thead class="bg-gray-100">
            <tr>
                <th class="answer-pdf-table-row">Q No.</th>
                <th class="answer-pdf-table-row">Answer</th>
                <th class="answer-pdf-table-row">Difficulty Level</th>
                <th class="answer-pdf-table-row">Chapter Name</th>
            </tr>
        </thead>
        <tbody>
            {{ $Counter := 0 }}
            {{ range $subject := .TestPtr.TypeParams.Subjects }}
                {{ range $section := $subject.Sections }}
                    <!-- Compulsory Problems -->
                    {{ range $prob := $section.Compulsory.Problems }}
                        {{ $p := index $.ProblemsMap $prob.ID }}
                        {{ $Counter = add $Counter 1 }}
                        <tr>
                            <td class="answer-pdf-table-row">{{ $Counter }}.</td>
                            <td class="answer-pdf-table-row">
                                {{ if eq $p.Subtype "mcq_single_answer" }}
                                    {{ range $p.MetaData.Answers }}
                                        {{ printf "%c" (add 64 (stringToInt .)) }}
                                    {{ end }}
                                {{ else }}
                                    {{ range $p.MetaData.Answers }}
                                        {{ . }}
                                    {{ end }}
                                {{ end }}
                            </td>
                            <td class="answer-pdf-table-row">{{ capitalize $p.DifficultyLevel }}</td>
                            <td class="answer-pdf-table-row">{{ getChapterName $p "en" }}</td>
                        </tr>
                    {{ end }}
                {{ end }}
            {{ end }}
        </tbody>
    </table>

    <!-- Solutions Section -->
    <div class="mt-6">
        <h2 class="text-lg font-bold mb-2">Solutions:</h2>
        {{ $Counter := 0 }}
        {{ range $subject := .TestPtr.TypeParams.Subjects }}
            {{ range $section := $subject.Sections }}
                <!-- Compulsory Problems -->
                {{ range $prob := $section.Compulsory.Problems }}
                    {{ $p := index $.ProblemsMap $prob.ID }}
                    {{ $Counter = add $Counter 1 }}
                    {{ if and (gt (len $p.MetaData.Solutions) 0) (ne (trim (printf "%s" (index $p.MetaData.Solutions 0).Value)) "") }}
                        <div class="mb-4 flex">
                            <span class="font-semibold">Q{{ $Counter }}.</span>
                            <span class="ml-5 block flex-1">{{ (index $p.MetaData.Solutions 0).Value }}</span>
                        </div>
                    {{ end }}
                {{ end }}
            {{ end }}
        {{ end }}
    </div>
</body>
</html>